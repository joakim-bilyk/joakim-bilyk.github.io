---
title: "Homework (FinKont)"
output:
  html_document:
    toc: no
    toc_float: yes
    code_folding: hide
---

```{r, include=FALSE, results = 'hide'}
library(ggplot2)
library(dplyr)
#rmarkdown::render(input = "FinKont_homework.Rmd", output_format = "pdf_document")
```


# Introduction

# Weeks {.tabset}

## Week 1

### Material

  * Brownian motion (Chapter 4.1)
  * Conditional expectation (Appendix B.5) 
  * Filtration (Appendix B.3 and Chapter 4.2)
  * Martingales (Appendix C.1 and Chapter 4.4)
  * Introduction (Chapter 1)
  * Discrete time models (Chapter 2 and 3)

### Theory

>**Definition 4.1.** *(Brownian motion)* A stochastic process $W$ is called a **Brownian motion** or **Wiener process** if the following conditions hold
>
> 1. <img class="math inline"  src="https://math.vercel.app?inline=W_0=0"/>.
> 2. The process <img class="math inline"  src="https://math.vercel.app?inline=W"/> has independent increments, i.e. if <img class="math inline"  src="https://math.vercel.app?inline=r<s\le t< u"/> then <img class="math inline" src="https://math.vercel.app?inline=W_u-W_t"/> and <img class="math inline"  src="https://math.vercel.app?inline=W_s-W_r"/> are independent random variables.
> 3. For <img class="math inline"  src="https://math.vercel.app?inline=s<t"/> the random variable <img class="math inline"  src="https://math.vercel.app?inline=W_t-W_s"/> has the Gaussian distribution <img class="math inline"  src="https://math.vercel.app?inline=\mathcal{N}(0,t-s)" />.
> 4. <img class="math inline"  src="https://math.vercel.app?inline=W"/> has continuous trajectories i.e. <img class="math inline"  src="https://math.vercel.app?inline=s\mapsto W(s;\omega)"/> i continuous for all <img class="math inline"  src="https://math.vercel.app?inline=\omega \in\Omega"/>.

```{r}
#Example of trajectory for BM
set.seed(1)
t <- 0:1000
N <- rnorm(
  n = length(t)-1, #initial value = 0
  mean = 0, #incements mean = 0
  sd = sqrt(t[2:length(t)] - t[1:(length(t)-1)]) #increment sd = sqrt(t-s)
)
W <- c(0,cumsum(N))
```
```{r,echo=FALSE,out.width= "50%", out.extra='style="float:right; padding:10px"',include=TRUE}
data.frame(t = t, W = W) %>%
  ggplot() +
  geom_line(aes(x=t,y=W)) +
  labs(title = "Realisation of a Brownian motion") +
  theme_bw() +
  theme(axis.text = element_text(size = 15),
        title = element_text(size = 18))
```

### Exercises

**Probability exercises**

Let <img class="math inline" src="https://math.vercel.app?inline=(W(t))_{t\ge}"/> be a Brownian motion (BjÃ¶rk, Definition 4.1).

**Exercise 1.** Show that the following processes also are Brownian motions.

 i. $(-W(t))_{t\ge 0}$ (symmetry)
 ii. For any $s\ge 0$, $(W(t+s)-W(s))_{t\ge 0}$ (time-homogeneity).
 iii. For every $c>0$, $(cW(t/c^2))_{t\ge 0}$ (scaling).

<details>
<summary>**Solution (i).**</summary>

By assumption $W$ is a Brownian motion and so it follows that

<span class="math center"><img src="https://math.vercel.app?from=-W_0=-1\cdot0=0."/></span>

Furthermore, for $r<s\le t< u$ it holds that $W_u-W_t$ and $W_s-W_r$ is independent. By seperate transformations the independence property is preserved and $-(W_u-W_t)$ and $-(W_s-W_r)$ is independent. Next, for a normal distributed random variable <img class="math inline"  src="https://math.now.sh?inline=N\sim\mathcal{N}(\mu,\sigma^2)"/> it holds, that for a scaler $c\in\mathbb{R}$ we have <img class="math inline"  src="https://math.vercel.app?inline=c N\sim\mathcal{N}(c\mu,c^2\sigma ^2)" />. Then obviously;

<span class="math center"><img src="https://math.vercel.app?from=-(W_t)=(-1)W_t\stackrel{d}{=}\mathcal{N}((-1)\cdot0,(-1)^2(t-s))\stackrel{d}{=}\mathcal{N}( 0,t-s)."/></span>

Lastly, let $\omega \in \Omega$ and consider the sample path <img src="https://math.vercel.app?inline=s\mapsto (-W_s)(\omega)"/>. Clearly for two continuous functions $f$ and $g$ it holds that <img src="https://math.vercel.app?inline=(g\circ f)"/> is continuous. Then with $g(f)=-f$ and <img src="https://math.vercel.app?inline=f(t)=W_t(\omega)"/>$ it follows that <img src="https://math.vercel.app?inline=(-W_t)=(g\circ W)(t)"/> is also continuous.

</details>
<details>
<summary>**Solution (ii).**</summary>

Much like the previous exercise we define a new process and show the properties hold. Let $s\ge 0$ be chosen arbitrary. Now define $X_t=W(t+s)-W(s)$.

First, we let $t=0$ and see

<span class="math center"><img src="https://math.vercel.app?from=X_0=W(0+s)-W(s)=W(s)-W(s)=0."/></span>

Secondly, we have that for $r<u$:

<span class="math center"><img src="https://math.vercel.app?from=X_u-X_r=W(u+s)-W(s)-(W(r+s)-W(s))=W(u+s)-W(r+s)\sim \mathcal{N}(0,u+s-(r+s))=\mathcal{N}(0,u-r)."/></span>

and since for $r<u\le k<l$ the translation $r+s<u+s\le k+s<l+s$ still holds and $X_l-X_k=W(l+s)-W(k+s)$ and $X_u-X_r=W(u+s)-W(k+s)$ are independent. Finally since $W_t(\omega)$ is continuous in $t$ hence the translation $W_{t+s}$ is continouos. Adding a constant yields a function that is also continuous, hence $X_t$ is continuous.

</details>
<details>
<summary>**Solution (iii).**</summary>

Let $c>0$ be given. We show that

<span class="math center"><img src="https://math.vercel.app?from=X_t=cW\left(\frac{t}{c^2}\right)"/></span>

is a Brownian motion. We simply show the four properties. Let $t=0$ and notice

<span class="math center"><img src="https://math.vercel.app?from=X_0=cW\left(\frac{0}{c^2}\right)=cW(0)=0."/></span>

The second property follows from seperate transformation and that for $r<u\le s<t$ we consider

<span class="math center"><img src="https://math.vercel.app?from=X_u-X_r=c\left(W\left(\frac{u}{c^2}\right)-W\left(\frac{r}{c^2}\right)\right)\hspace{20pt}\text{and}\hspace{20pt}X_t-X_s=c\left(W\left(\frac{t}{c^2}\right)-W\left(\frac{s}{c^2}\right)\right)"/></span>

and since $c,r,u,t,s>0$ we have the same order for the scaled version of $r,u,t,s$ and hence we have two independent RV scaled by $c$. Then by seperate transformations the variables is still independent. Next for the third property:

<span class="math center"><img src="https://math.vercel.app?from=X_t-X_s=c\left(W\left(\frac{t}{c^2}\right)-W\left(\frac{s}{c^2}\right)\right)\sim\mathcal{N}\left(c\cdot 0,c^2\left(\frac{t}{c^2}-\frac{s}{c^2}\right)\right)=\mathcal{N}(0,t-s)."/></span>

Where we use the properties of scaling a normal distributed random variable i.e. for $c>0$ and <img class="math inline"  src="https://math.vercel.app?inline= N\sim\mathcal{N}(\mu,\sigma ^2)" /> it follows that <img class="math inline"  src="https://math.vercel.app?inline=c N\sim\mathcal{N}(c\mu,c^2\sigma ^2)" />. Finally, the forth property follows since $g(f)=cf$ is continuous and $h(t)=t/c^2$ is continuous, then for any continuous function $f(s)$ it follows that <img src="https://math.vercel.app?inline=(g \circ f\circ h)=g(f(h(t)))"/> is continuous.

</details>

&nbsp;

>**Proposition B.37.** Let <img src="https://math.vercel.app?inline=(\Omega,\mathcal{F},P)"/> be a given probability space, let <img src="https://math.vercel.app?inline=\mathcal{G}"/> be a sub-sigma-algebra of <img src="https://math.vercel.app?inline=\mathcal{F}"/>, and let $X$ be a square integrable random variable.
>Consider the problem of minimizing
><span class="math center"><img src="https://math.vercel.app?from=E\left[(X-Z)^2\right]"/></span>
>where $Z$ is allowed to vary over the class of all square integrable <img src="https://math.vercel.app?inline=\mathcal{G}"/> measurable random variables. The optimal solution <img src="https://math.vercel.app?inline=\hat{Z}"/> is then given by.
><span class="math center"><img src="https://math.vercel.app?from=\hat{Z}=E[X\vert\mathcal{G}]."/></span>

**Exercise B.11.** *(Bjork)* Prove proposition B.37 by going along the following lines.

  a. Prove that the "estimation error" <img src="https://math.vercel.app?inline=X-E[X\vert\mathcal{G}]"/> is orthogonal to <img src="https://math.vercel.app?inline=L^2(\Omega,\mathcal{G},P)"/> in the sence that for any <img src="https://math.vercel.app?inline=Z\in L^2(\Omega,\mathcal{G},P)"/> we have
  <span class="math center"><img src="https://math.vercel.app?from=E[Z\cdot(X-E[X\vert\mathcal{G}])]=0"/></span>
  b. Now prove the proposition by writing
  <span class="math center"><img src="https://math.vercel.app?from=X-Z=(X-E[X\vert\mathcal{G}])%2B(E[X\vert\mathcal{G}]-Z)"/></span>
  and use the result just proved.

<details>
<summary>**Solution (a).**</summary>



</details>
<details>
<summary>**Solution (b).**</summary>



</details>

&nbsp;

## Week 2 

### Material

MFE refers to the book by McNeil, Frey, and Embrechts, while HL refers to the notes by Hult and Lindskog posted on Absalon.

 * Var-Cov method, simulation, importance sampling and bootstrap. For the Var-Cov method, see MFE Sec. 9.2. For importance sampling and bootstrap, see the supplementary reading in Absalon.
 * Extreme value theory: MFE Ch. 5 or alternative reading in HL (suggested for this part).

### Theory

### Exercises

## Week 3

### Material

MFE refers to the book by McNeil, Frey, and Embrechts, while HL refers to the notes by Hult and Lindskog posted on Absalon.

 * Spherical and elliptical distributions: MFE Sec. 6.3.
 * Spherical and elliptical distributions, cont.; introduction to copulas.

### Theory

### Exercises

## Week 4

### Material

MFE refers to the book by McNeil, Frey, and Embrechts, while HL refers to the notes by Hult and Lindskog posted on Absalon.

 * Copulas: MFE Sec. 7.1-7.5 (Sklar's theorem, Frechet bounds).
 * Copulas cont. (Transformations; examples; Archimedean copulas).

### Theory

### Exercises

## Week 5

### Material

MFE refers to the book by McNeil, Frey, and Embrechts, while HL refers to the notes by Hult and Lindskog posted on Absalon.

 * Copulas cont. (simulating Archimedean copulas, statistical methods, measures of dependence).
 * Credit risk: the Merton model. MFE Ch. 10, particularly Sec. 10.3. [This lecture will only last two hours.]

### Theory

### Exercises

## Week 6

### Material

MFE refers to the book by McNeil, Frey, and Embrechts, while HL refers to the notes by Hult and Lindskog posted on Absalon.

 * Portfolio credit risk: MFE Ch. 11, specifically Sections 11.1-11.3.
 * Portfolio credit risk, cont. [This lecture will only last two hours.]

### Theory

### Exercises

## Week 7

### Material

MFE refers to the book by McNeil, Frey, and Embrechts, while HL refers to the notes by Hult and Lindskog posted on Absalon.

 * Intro. to operational risk. Stochastic processes in risk management: stochastic models for operational risk; financial time series models. Connections to non-life insurance models and estimates (last lecture).

### Theory

### Exercises
