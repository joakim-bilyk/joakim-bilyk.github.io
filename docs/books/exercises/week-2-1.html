<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.2 Week 2 | Exercises</title>
  <meta name="description" content="3.2 Week 2 | Exercises" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="3.2 Week 2 | Exercises" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.2 Week 2 | Exercises" />
  
  
  

<meta name="author" content="Joakim Bilyk" />


<meta name="date" content="2023-03-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="week-1-1.html"/>
<link rel="next" href="week-3-1.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-1.9.1.js"></script>

<script>
    $(function() {
        var element = document.body;
        if (localStorage.chkbx && localStorage.chkbx != '') {
            $('#remember_me').attr('checked', 'checked');
            element.classList.toggle("dark-mode");
            document.querySelector('.book-header.fixed').click();
        } else {
            $('#remember_me').removeAttr('checked');
            document.querySelector('.book-header.fixed').click();
        }

        $('#remember_me').click(function() {

            if ($('#remember_me').is(':checked')) {
                // save username and password
                localStorage.chkbx = $('#remember_me').val();
                element.classList.toggle("dark-mode");
                document.querySelector('.book-header.fixed').click();
            } else {
                localStorage.chkbx = '';
                element.classList.toggle("dark-mode");
                document.querySelector('.book-header.fixed').click();
            }
        });
    });

</script>

<div class = "sticky-darkmode-toggle">
  <label class="switch">
  <input type="checkbox" value="remember-me" id="remember_me">
  <span class="slider round">
  </span>
  </label>
</div>

<script>
$(function() {
  $('body').after($('.sticky-darkmode-toggle'));
})
</script>

<style>

.sticky-darkmode-toggle {
  position: fixed;
  right: 20px;
  bottom: 20px;
}
</style>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Exercises</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="abbreviations.html"><a href="abbreviations.html"><i class="fa fa-check"></i><b>1.1</b> Abbreviations</a></li>
<li class="chapter" data-level="1.2" data-path="to-do-work.html"><a href="to-do-work.html"><i class="fa fa-check"></i><b>1.2</b> To-do work</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="continuous-time-finance.html"><a href="continuous-time-finance.html"><i class="fa fa-check"></i><b>2</b> Continuous Time Finance</a>
<ul>
<li class="chapter" data-level="2.1" data-path="week-1.html"><a href="week-1.html"><i class="fa fa-check"></i><b>2.1</b> Week 1</a></li>
<li class="chapter" data-level="2.2" data-path="week-2.html"><a href="week-2.html"><i class="fa fa-check"></i><b>2.2</b> Week 2</a></li>
<li class="chapter" data-level="2.3" data-path="week-3.html"><a href="week-3.html"><i class="fa fa-check"></i><b>2.3</b> Week 3</a></li>
<li class="chapter" data-level="2.4" data-path="week-4.html"><a href="week-4.html"><i class="fa fa-check"></i><b>2.4</b> Week 4</a></li>
<li class="chapter" data-level="2.5" data-path="week-5.html"><a href="week-5.html"><i class="fa fa-check"></i><b>2.5</b> Week 5</a></li>
<li class="chapter" data-level="2.6" data-path="week-6.html"><a href="week-6.html"><i class="fa fa-check"></i><b>2.6</b> Week 6</a></li>
<li class="chapter" data-level="2.7" data-path="week-7.html"><a href="week-7.html"><i class="fa fa-check"></i><b>2.7</b> Week 7</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-machine-learning.html"><a href="probabilistic-machine-learning.html"><i class="fa fa-check"></i><b>3</b> Probabilistic Machine Learning</a>
<ul>
<li class="chapter" data-level="3.1" data-path="week-1-1.html"><a href="week-1-1.html"><i class="fa fa-check"></i><b>3.1</b> Week 1</a></li>
<li class="chapter" data-level="3.2" data-path="week-2-1.html"><a href="week-2-1.html"><i class="fa fa-check"></i><b>3.2</b> Week 2</a></li>
<li class="chapter" data-level="3.3" data-path="week-3-1.html"><a href="week-3-1.html"><i class="fa fa-check"></i><b>3.3</b> Week 3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="topics-in-life-insurance.html"><a href="topics-in-life-insurance.html"><i class="fa fa-check"></i><b>4</b> Topics in Life Insurance</a>
<ul>
<li class="chapter" data-level="4.1" data-path="computing-moments-of-reserve-in-timehomogeneous-case.html"><a href="computing-moments-of-reserve-in-timehomogeneous-case.html"><i class="fa fa-check"></i><b>4.1</b> Computing moments of reserve in timehomogeneous case</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://joakim-bilyk.github.io/index.html">Back to main site</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="week-2-1" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Week 2<a href="week-2-1.html#week-2-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From now on, given sample size <span class="math inline">\(n\)</span>, a dimension <span class="math inline">\(p\)</span>, and a correlation parameter <span class="math inline">\(0\le \texttt{rho}&lt;1\)</span> we will generate data <span class="math inline">\(X\)</span> via the following code.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="week-2-1.html#cb38-1" aria-hidden="true" tabindex="-1"></a>z_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(p<span class="sc">*</span>n,<span class="dv">0</span>,(<span class="dv">1</span><span class="sc">-</span>rho)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb38-2"><a href="week-2-1.html#cb38-2" aria-hidden="true" tabindex="-1"></a>z_0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,rho<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb38-3"><a href="week-2-1.html#cb38-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fl">2.5</span><span class="sc">*</span><span class="fu">atan</span>(z_1<span class="sc">+</span>z_0)<span class="sc">/</span>pi</span>
<span id="cb38-4"><a href="week-2-1.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X) <span class="ot">&lt;-</span> <span class="fu">c</span>(n,p)</span></code></pre></div>
<p>The resulting features will have approximately support on <span class="math inline">\([−1, 1]\)</span> and will have approximately pairwise correlation of size <span class="math inline">\(\texttt{rho}\)</span>. Given the distribution of <span class="math inline">\(\varepsilon\)</span> and a regression function <span class="math inline">\(m\)</span>, we then generate data <span class="math inline">\((X_i,Y_i)_{i=1,...,n}\)</span> via</p>
<p><span class="math display">\[
Y_i=m(X_i)+\varepsilon_i,
\]</span></p>
<p>where <span class="math inline">\(\varepsilon_i\)</span> are iid copies of <span class="math inline">\(\varepsilon\)</span> and <span class="math inline">\(X_i\)</span> is the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(X\)</span>.</p>
<p><strong>Exercise 1.</strong> We want to try out ordinary least squares regression, lasso, ridge regression and elastic net on some different data generating settings (Model 1–4).</p>
<table style="width:100%;">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">n</th>
<th align="center">p</th>
<th align="center">s</th>
<th align="center">rho</th>
<th align="center">m</th>
<th align="center"><span class="math inline">\(\varepsilon\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Model 1</td>
<td align="center">1000</td>
<td align="center">100</td>
<td align="center">5</td>
<td align="center">0.3</td>
<td align="center"><span class="math inline">\(\sum_{j=1}^s x_j\)</span></td>
<td align="center"><span class="math inline">\(\mathcal N(0,1)\)</span></td>
</tr>
<tr class="even">
<td align="left">Model 2</td>
<td align="center">1000</td>
<td align="center">100</td>
<td align="center">100</td>
<td align="center">0.3</td>
<td align="center"><span class="math inline">\(\sum_{j=1}^s x_j\)</span></td>
<td align="center"><span class="math inline">\(\mathcal N(0,1)\)</span></td>
</tr>
<tr class="odd">
<td align="left">Model 3</td>
<td align="center">1000</td>
<td align="center">100</td>
<td align="center">5</td>
<td align="center">0.3</td>
<td align="center"><span class="math inline">\(\sum_{j=1}^s 0.1x_j\)</span></td>
<td align="center"><span class="math inline">\(\mathcal N(0,1)\)</span></td>
</tr>
<tr class="even">
<td align="left">Model 4</td>
<td align="center">1000</td>
<td align="center">100</td>
<td align="center">100</td>
<td align="center">0.3</td>
<td align="center"><span class="math inline">\(\sum_{j=1}^s 0.1x_j\)</span></td>
<td align="center"><span class="math inline">\(\mathcal N(0,1)\)</span></td>
</tr>
</tbody>
</table>
<ol style="list-style-type: lower-alpha">
<li>Given one set of training data for each model tune (i.e. estimate optimal hyperprameter) via 5-fold cross-validation using a search method and number of evals of your choice. You should now have an estimated optimal hyperparameter for every combination of model and method.</li>
<li>Generate 100 test sets each of size n for every model and calculate empirical mean and standard deviation of the test error for each method and model using the hyperparameters calculated in (a). Create a table of your results (each missing entry should show hyperparameter: mean(sd)):</li>
</ol>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="center">Least Squares</th>
<th align="center">Ridge</th>
<th align="center">Lasso</th>
<th align="center">Elastic Net</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Model 1</td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
</tr>
<tr class="even">
<td align="left">Model 2</td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
</tr>
<tr class="odd">
<td align="left">Model 3</td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
</tr>
<tr class="even">
<td align="left">Model 4</td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
<td align="center"><span class="math inline">\(\cdot\)</span></td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: lower-alpha">
<li>Discuss why test error alone might often not be the (only) quantity of interest.</li>
</ol>
<details>
<summary>
<strong>Solution (a).</strong>
</summary>
<p>We start by simulating the data with the seed 1 for the training data and 2 for testing data.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="week-2-1.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Generate data</span></span>
<span id="cb39-2"><a href="week-2-1.html#cb39-2" aria-hidden="true" tabindex="-1"></a>generateData <span class="ot">&lt;-</span> <span class="cf">function</span>(n,p,s,rho,m,epsilon,seed) {</span>
<span id="cb39-3"><a href="week-2-1.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb39-4"><a href="week-2-1.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  z_1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(p<span class="sc">*</span>n,<span class="dv">0</span>,(<span class="dv">1</span><span class="sc">-</span>rho)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb39-5"><a href="week-2-1.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  z_0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,rho<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb39-6"><a href="week-2-1.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fl">2.5</span><span class="sc">*</span><span class="fu">atan</span>(z_1<span class="sc">+</span>z_0)<span class="sc">/</span>pi</span>
<span id="cb39-7"><a href="week-2-1.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(X) <span class="ot">&lt;-</span> <span class="fu">c</span>(n,p)</span>
<span id="cb39-8"><a href="week-2-1.html#cb39-8" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="fu">m</span>(X) <span class="sc">+</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,epsilon)</span>
<span id="cb39-9"><a href="week-2-1.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y =</span> Y, <span class="at">X=</span>X)</span>
<span id="cb39-10"><a href="week-2-1.html#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">dat=</span>dat,<span class="at">Y=</span>Y,<span class="at">X=</span>X))</span>
<span id="cb39-11"><a href="week-2-1.html#cb39-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Model 1</strong></p>
<p>We may now estimate under model 1 by setting the parameters and generating the data.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="week-2-1.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model 1</span></span>
<span id="cb40-2"><a href="week-2-1.html#cb40-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb40-3"><a href="week-2-1.html#cb40-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb40-4"><a href="week-2-1.html#cb40-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb40-5"><a href="week-2-1.html#cb40-5" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb40-6"><a href="week-2-1.html#cb40-6" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="fu">rowSums</span>(x[,<span class="dv">1</span><span class="sc">:</span>s])}</span>
<span id="cb40-7"><a href="week-2-1.html#cb40-7" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb40-8"><a href="week-2-1.html#cb40-8" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> <span class="fu">generateData</span>(n,p,s,rho,m,epsilon,<span class="dv">1</span>)<span class="sc">$</span>dat</span>
<span id="cb40-9"><a href="week-2-1.html#cb40-9" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> <span class="fu">generateData</span>(n,p,s,rho,m,epsilon,<span class="dv">2</span>)<span class="sc">$</span>dat</span>
<span id="cb40-10"><a href="week-2-1.html#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_train[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre><code>##            Y         X.1         X.2        X.3        X.4        X.5
## 1  1.8309143 -0.07193125  0.75183303 -0.2377002  0.6451155 -0.3789598
## 2  1.4939672  0.28091848  0.67874915 -0.7546614  0.3929413  0.5626808
## 3  0.3964524 -0.60794426 -0.61996908  0.6615121  0.5492820  0.1712623
## 4  0.1283924  0.65701309 -0.05919154  0.1445119 -0.5932112 -0.7514690
## 5 -2.2628749  0.14449216 -0.02706905 -0.1097656 -0.7651413 -0.8446573
## 6  1.7979838 -0.27896899 -0.65200577  0.5846706  0.6634413  0.5440794
##          X.6         X.7        X.8        X.9
## 1 -0.5537303 -0.06689199 -0.4727280  0.4609656
## 2  0.5075691 -0.49311711  0.6294640 -0.3555881
## 3 -0.8191675 -0.89258755  0.3435102 -0.7775838
## 4  0.5050303 -0.21505308  0.4511738  0.6831925
## 5  0.5573768 -0.23918147 -0.2927378 -0.7521317
## 6 -0.4938379  0.52113194  0.1657710  0.1270910</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="week-2-1.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_test[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre><code>##           Y         X.1         X.2        X.3        X.4         X.5
## 1 -2.985333 -0.70532654 -0.06742898 -0.8900989 -0.9190374  0.04862538
## 2 -2.057488 -0.13035879  0.35533591  0.5180006 -0.6532359 -0.81848843
## 3 -2.218149  0.75916886 -0.49168949 -0.3268390  0.1625926 -0.41165505
## 4 -0.176265 -0.77652654 -0.36866613  0.2601691  0.3100563 -0.86620293
## 5  1.780030  0.39826072 -0.06440487  0.8050035  0.8184016  0.50856826
## 6 -2.539077 -0.01983207  0.25397105 -0.7543274 -0.6668646 -0.66975619
##          X.6         X.7         X.8         X.9
## 1 -0.8684129 -0.73370531  0.28994890 -0.36455945
## 2 -0.5053897  0.23098162 -0.24853540  0.37132666
## 3 -0.1681142  0.09490974 -0.61895581 -0.36122745
## 4 -0.1963916 -0.59210876  0.43663155 -0.51196618
## 5  0.1529196 -0.36622001  0.66508279  0.09886413
## 6 -0.6373294 -0.71339909 -0.09165955 -0.05701028</code></pre>
<p>We can estimate the optimal parameters under least squares estimation with the <code>lm</code> function.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="week-2-1.html#cb44-1" aria-hidden="true" tabindex="-1"></a>ls_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> ., <span class="at">data =</span> data_train)</span></code></pre></div>
<p>We can use <code>predict</code> to see the model prediction vs. the true values.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="week-2-1.html#cb45-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">response =</span> <span class="fu">predict</span>(ls_lm,data_test),</span>
<span id="cb45-2"><a href="week-2-1.html#cb45-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">truth =</span> data_test<span class="sc">$</span>Y)</span></code></pre></div>
<p><img src="figures/ML_week2_ex1_01.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We can also use <code>mlr3</code> to tune optimal hyperparameters for a lasso, ridge and elastic net estimator. We start as usual by slitting the data into training and testing datasets and starting a task.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="week-2-1.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the relevant libraries</span></span>
<span id="cb46-2"><a href="week-2-1.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb46-3"><a href="week-2-1.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners )</span>
<span id="cb46-4"><a href="week-2-1.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3tuning)</span>
<span id="cb46-5"><a href="week-2-1.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3mbo)</span>
<span id="cb46-6"><a href="week-2-1.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="week-2-1.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Start task</span></span>
<span id="cb46-8"><a href="week-2-1.html#cb46-8" aria-hidden="true" tabindex="-1"></a>task_model1 <span class="ot">=</span> <span class="fu">as_task_regr</span>(</span>
<span id="cb46-9"><a href="week-2-1.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  data_train,</span>
<span id="cb46-10"><a href="week-2-1.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">target =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb46-11"><a href="week-2-1.html#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">&quot;model1&quot;</span></span>
<span id="cb46-12"><a href="week-2-1.html#cb46-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can now initiate a leaner. We start by fitting the hyperparameter for the lasso learner.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="week-2-1.html#cb47-1" aria-hidden="true" tabindex="-1"></a>learner_lasso <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)</span></code></pre></div>
<p>We use the <code>glmnet</code> as it is an algorithm that solves the minimizing problem</p>
<p><span class="math display">\[
\hat{\beta}_\lambda^{\text {glmnet }} =\underset{\beta \in \mathbb{R}^p}{\arg \min }\left\{\hat{R}_n(\beta)+J_\lambda(\beta)\right\},\hspace{15pt}J_\lambda(\beta)=\lambda \left[\alpha\sum_{j=1}^p\left|\beta_j\right|+\frac{1-\alpha}{2}\sum_{j=1}^p\beta_j^2\right],
\]</span></p>
<p>One may recall that the lasso estimator is given by</p>
<p><span class="math display">\[
\hat{\beta}_\lambda^{\text {lasso }} =\underset{\beta \in \mathbb{R}^p}{\arg \min }\left\{\hat{R}_n(\beta)+J_\lambda(\beta)\right\},\hspace{15pt}J_\lambda(\beta)=\lambda \sum_{j=1}^p\left|\beta_j\right|,
\]</span></p>
<p>and so the lasso estimator is a specialcase of the <code>glmnet</code> with <span class="math inline">\(\alpha=1\)</span>. From the above we see that the minimizing algorithm punishes large beta’s. The hyperparameter to tune is then <span class="math inline">\(\lambda\ge 0\)</span> (<code>s</code> is the syntax for <span class="math inline">\(\lambda\)</span>). Looking at the parameters in the <code>learner_lasso</code> one can see the entire hyperparameter space.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="week-2-1.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(learner_lasso <span class="sc">$</span>param_set)[, <span class="fu">list</span>(id, class, lower, upper, nlevels)]</span></code></pre></div>
<pre><code>##                       id    class lower upper nlevels
##  1:            alignment ParamFct    NA    NA       2
##  2:                alpha ParamDbl     0     1     Inf
##  3:                  big ParamDbl  -Inf   Inf     Inf
##  4:               devmax ParamDbl     0     1     Inf
##  5:                dfmax ParamInt     0   Inf     Inf
##  6:                  eps ParamDbl     0     1     Inf
##  7:                epsnr ParamDbl     0     1     Inf
##  8:                exact ParamLgl    NA    NA       2
##  9:              exclude ParamInt     1   Inf     Inf
## 10:                 exmx ParamDbl  -Inf   Inf     Inf
## 11:               family ParamFct    NA    NA       2
## 12:                 fdev ParamDbl     0     1     Inf
## 13:                gamma ParamDbl  -Inf   Inf     Inf
## 14:              grouped ParamLgl    NA    NA       2
## 15:            intercept ParamLgl    NA    NA       2
## 16:                 keep ParamLgl    NA    NA       2
## 17:               lambda ParamUty    NA    NA     Inf
## 18:     lambda.min.ratio ParamDbl     0     1     Inf
## 19:         lower.limits ParamUty    NA    NA     Inf
## 20:                maxit ParamInt     1   Inf     Inf
## 21:                mnlam ParamInt     1   Inf     Inf
## 22:                 mxit ParamInt     1   Inf     Inf
## 23:               mxitnr ParamInt     1   Inf     Inf
## 24:            newoffset ParamUty    NA    NA     Inf
## 25:              nlambda ParamInt     1   Inf     Inf
## 26:               offset ParamUty    NA    NA     Inf
## 27:             parallel ParamLgl    NA    NA       2
## 28:       penalty.factor ParamUty    NA    NA     Inf
## 29:                 pmax ParamInt     0   Inf     Inf
## 30:                 pmin ParamDbl     0     1     Inf
## 31:                 prec ParamDbl  -Inf   Inf     Inf
## 32:                relax ParamLgl    NA    NA       2
## 33:                    s ParamDbl     0   Inf     Inf
## 34:          standardize ParamLgl    NA    NA       2
## 35: standardize.response ParamLgl    NA    NA       2
## 36:               thresh ParamDbl     0   Inf     Inf
## 37:             trace.it ParamInt     0     1       2
## 38:        type.gaussian ParamFct    NA    NA       2
## 39:        type.logistic ParamFct    NA    NA       2
## 40:     type.multinomial ParamFct    NA    NA       2
## 41:         upper.limits ParamUty    NA    NA     Inf
##                       id    class lower upper nlevels</code></pre>
<p>Let us tune a lasso learner by setting <code>alpha = 1</code> and tuning <code>s = totune(0,1)</code> i.e. searching for <span class="math inline">\(\lambda \in [0,1]\)</span>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="week-2-1.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the learner</span></span>
<span id="cb50-2"><a href="week-2-1.html#cb50-2" aria-hidden="true" tabindex="-1"></a>my_lasso_learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>,</span>
<span id="cb50-3"><a href="week-2-1.html#cb50-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">s=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb50-4"><a href="week-2-1.html#cb50-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb50-5"><a href="week-2-1.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Tune the learner</span></span>
<span id="cb50-6"><a href="week-2-1.html#cb50-6" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">=</span> <span class="fu">tune</span>(</span>
<span id="cb50-7"><a href="week-2-1.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>), <span class="do">### tuning method</span></span>
<span id="cb50-8"><a href="week-2-1.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> task_model1,</span>
<span id="cb50-9"><a href="week-2-1.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> my_lasso_learner,</span>
<span id="cb50-10"><a href="week-2-1.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>), <span class="do">#### resampling method: 5-fold cross validation</span></span>
<span id="cb50-11"><a href="week-2-1.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">&quot;regr.rmse&quot;</span>), <span class="do">#### root mean squared error</span></span>
<span id="cb50-12"><a href="week-2-1.html#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">100</span>) <span class="do">#### terminator</span></span>
<span id="cb50-13"><a href="week-2-1.html#cb50-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="week-2-1.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#One might go through the archive</span></span>
<span id="cb51-2"><a href="week-2-1.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#as.data.table(instance$archive)</span></span>
<span id="cb51-3"><a href="week-2-1.html#cb51-3" aria-hidden="true" tabindex="-1"></a>instance<span class="sc">$</span>result</span></code></pre></div>
<pre><code>##             s learner_param_vals  x_domain regr.rmse
## 1: 0.06178124          &lt;list[3]&gt; &lt;list[1]&gt;  1.037023</code></pre>
<p>Now that we have tuned the algorithm we can fit the model with the above <span class="math inline">\(s\)</span> (0.0618).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="week-2-1.html#cb53-1" aria-hidden="true" tabindex="-1"></a>lasso_tuned <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)  </span>
<span id="cb53-2"><a href="week-2-1.html#cb53-2" aria-hidden="true" tabindex="-1"></a>lasso_tuned<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> instance<span class="sc">$</span>result_learner_param_vals</span>
<span id="cb53-3"><a href="week-2-1.html#cb53-3" aria-hidden="true" tabindex="-1"></a>lasso_tuned<span class="sc">$</span><span class="fu">train</span>(task_model1)</span></code></pre></div>
<p>Lets quickly look at the predictions.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="week-2-1.html#cb54-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> lasso_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(data_test)</span></code></pre></div>
<p><img src="figures/ML_week2_ex1_02.png" width="75%" style="display: block; margin: auto;" /></p>
<p>One can get the coefficients of <span class="math inline">\(\beta\)</span> by predicting the data frame <code>I = diag(1,nrow = 100)</code> being the identity.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="week-2-1.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make identity matrix</span></span>
<span id="cb55-2"><a href="week-2-1.html#cb55-2" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="at">x=</span><span class="dv">1</span>,<span class="at">nrow =</span> p) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb55-3"><a href="week-2-1.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(I) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_train)[<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb55-4"><a href="week-2-1.html#cb55-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> lasso_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(I) </span>
<span id="cb55-5"><a href="week-2-1.html#cb55-5" aria-hidden="true" tabindex="-1"></a>beta_lasso <span class="ot">&lt;-</span> predictions<span class="sc">$</span>response <span class="co">#Look at the beta</span></span>
<span id="cb55-6"><a href="week-2-1.html#cb55-6" aria-hidden="true" tabindex="-1"></a>beta_lasso</span></code></pre></div>
<pre><code>##   [1] 0.99915093 0.79086275 0.99541349 0.94102686 0.93627752 0.03315185
##   [7] 0.03315185 0.03315185 0.03315185 0.03315185 0.10981076 0.03315185
##  [13] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [19] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [25] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [31] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [37] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [43] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [49] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [55] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [61] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [67] 0.14390239 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [73] 0.03315185 0.07565291 0.03315185 0.03315185 0.03315185 0.03315185
##  [79] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [85] 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185 0.03315185
##  [91] 0.03315185 0.03315185 0.03315185 0.03315185 0.06264766 0.04897566
##  [97] 0.03315185 0.03315185 0.03315185 0.03315185</code></pre>
<p>One can see that the values is close to the true value <span class="math inline">\(\beta=(1,1,1,1,1,0,...,0)\)</span>.</p>
<p>We can now estimate the parameters in ridge regression by setting <span class="math inline">\(\alpha = 0\)</span> and then getting a scaled version of <span class="math inline">\(\lambda\)</span>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="week-2-1.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the learner</span></span>
<span id="cb57-2"><a href="week-2-1.html#cb57-2" aria-hidden="true" tabindex="-1"></a>my_ridge_learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>,</span>
<span id="cb57-3"><a href="week-2-1.html#cb57-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">s=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb57-4"><a href="week-2-1.html#cb57-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span><span class="dv">0</span>)</span>
<span id="cb57-5"><a href="week-2-1.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Tune the learner</span></span>
<span id="cb57-6"><a href="week-2-1.html#cb57-6" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">=</span> <span class="fu">tune</span>(</span>
<span id="cb57-7"><a href="week-2-1.html#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>), <span class="do">### tuning method</span></span>
<span id="cb57-8"><a href="week-2-1.html#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> task_model1,</span>
<span id="cb57-9"><a href="week-2-1.html#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> my_ridge_learner,</span>
<span id="cb57-10"><a href="week-2-1.html#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>), <span class="do">#### resampling method: 5-fold cross validation</span></span>
<span id="cb57-11"><a href="week-2-1.html#cb57-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">&quot;regr.rmse&quot;</span>), <span class="do">#### root mean squared error</span></span>
<span id="cb57-12"><a href="week-2-1.html#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">100</span>) <span class="do">#### terminator</span></span>
<span id="cb57-13"><a href="week-2-1.html#cb57-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="week-2-1.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#One might go through the archive</span></span>
<span id="cb58-2"><a href="week-2-1.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#as.data.table(instance$archive)</span></span>
<span id="cb58-3"><a href="week-2-1.html#cb58-3" aria-hidden="true" tabindex="-1"></a>instance<span class="sc">$</span>result</span></code></pre></div>
<pre><code>##            s learner_param_vals  x_domain regr.rmse
## 1: 0.2199674          &lt;list[3]&gt; &lt;list[1]&gt;  1.100857</code></pre>
<p>We fit the model with the above <span class="math inline">\(s\)</span> (0.22).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="week-2-1.html#cb60-1" aria-hidden="true" tabindex="-1"></a>ridge_tuned <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)  </span>
<span id="cb60-2"><a href="week-2-1.html#cb60-2" aria-hidden="true" tabindex="-1"></a>ridge_tuned<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> instance<span class="sc">$</span>result_learner_param_vals</span>
<span id="cb60-3"><a href="week-2-1.html#cb60-3" aria-hidden="true" tabindex="-1"></a>ridge_tuned<span class="sc">$</span><span class="fu">train</span>(task_model1)</span></code></pre></div>
<p>Lets quickly look at the predictions.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="week-2-1.html#cb61-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> ridge_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(data_test)</span></code></pre></div>
<p><img src="figures/ML_week2_ex1_03.png" width="75%" style="display: block; margin: auto;" /></p>
<p>For good measures we calculate the beta’s as in lasso.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="week-2-1.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make identity matrix</span></span>
<span id="cb62-2"><a href="week-2-1.html#cb62-2" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="at">x=</span><span class="dv">1</span>,<span class="at">nrow =</span> p) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb62-3"><a href="week-2-1.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(I) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_train)[<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb62-4"><a href="week-2-1.html#cb62-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> ridge_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(I)</span>
<span id="cb62-5"><a href="week-2-1.html#cb62-5" aria-hidden="true" tabindex="-1"></a>beta_ridge <span class="ot">&lt;-</span> predictions<span class="sc">$</span>response <span class="co">#Look at the beta</span></span>
<span id="cb62-6"><a href="week-2-1.html#cb62-6" aria-hidden="true" tabindex="-1"></a>beta_ridge</span></code></pre></div>
<pre><code>##   [1]  9.572446e-01  7.686100e-01  9.449922e-01  9.287205e-01  8.981642e-01
##   [6]  9.963081e-02  1.190889e-01  6.680920e-02 -2.360800e-02  2.529436e-02
##  [11]  2.085035e-01 -1.952593e-02  2.693690e-03 -6.889561e-02  2.116001e-02
##  [16]  2.781748e-02  1.121865e-01  9.137978e-02  2.454655e-02  4.820396e-02
##  [21]  4.539692e-02 -1.432497e-03  1.660669e-02  7.668634e-02  7.671318e-02
##  [26]  4.975334e-02  7.260690e-02 -8.629362e-03  7.456080e-02  5.825794e-02
##  [31] -4.527776e-02  6.807175e-02 -1.271848e-02 -2.748982e-02  1.203625e-01
##  [36]  7.651944e-02  6.392636e-02  1.101667e-02  1.734406e-02  6.945025e-02
##  [41]  2.999642e-02 -3.187841e-02 -1.155532e-01 -5.211477e-02  5.219365e-02
##  [46]  8.412732e-05  2.443844e-02  1.710180e-02 -4.820703e-02  5.932595e-02
##  [51] -4.195687e-03  3.171758e-02  8.042820e-03 -4.803883e-02  3.413274e-02
##  [56]  5.680607e-02  2.805170e-03  1.155576e-02  9.527637e-02 -4.649393e-02
##  [61] -1.231626e-02  8.193416e-02  1.487057e-02 -7.600475e-03  7.944417e-02
##  [66] -2.025782e-02  1.928551e-01  2.477441e-02  6.769122e-03  3.546825e-02
##  [71]  1.145399e-01  6.519184e-03  3.783939e-02  1.520270e-01  5.808354e-02
##  [76] -5.988705e-03 -9.409675e-03 -5.117966e-02 -5.673331e-02  1.858218e-02
##  [81]  7.114004e-02 -6.238344e-02 -5.586778e-02  4.614891e-02  1.147374e-02
##  [86]  7.358890e-02 -7.752170e-02  4.166919e-02 -3.679839e-02  1.558774e-02
##  [91]  5.154878e-02  9.195644e-02  7.103979e-02  8.703200e-02  1.601304e-01
##  [96]  1.444098e-01  5.452382e-02 -8.407149e-02 -6.720288e-02  8.402896e-02</code></pre>
<p>Finally, let us tune an elastic net.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="week-2-1.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define the learner</span></span>
<span id="cb64-2"><a href="week-2-1.html#cb64-2" aria-hidden="true" tabindex="-1"></a>my_elastic_learner <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>,</span>
<span id="cb64-3"><a href="week-2-1.html#cb64-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">s=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb64-4"><a href="week-2-1.html#cb64-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb64-5"><a href="week-2-1.html#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Tune the learner</span></span>
<span id="cb64-6"><a href="week-2-1.html#cb64-6" aria-hidden="true" tabindex="-1"></a>instance <span class="ot">=</span> <span class="fu">tune</span>(</span>
<span id="cb64-7"><a href="week-2-1.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>), <span class="do">### tuning method</span></span>
<span id="cb64-8"><a href="week-2-1.html#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> task_model1,</span>
<span id="cb64-9"><a href="week-2-1.html#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">learner =</span> my_elastic_learner,</span>
<span id="cb64-10"><a href="week-2-1.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>), <span class="do">#### resampling method: 5-fold cross validation</span></span>
<span id="cb64-11"><a href="week-2-1.html#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">&quot;regr.rmse&quot;</span>), <span class="do">#### root mean squared error</span></span>
<span id="cb64-12"><a href="week-2-1.html#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">100</span>) <span class="do">#### terminator</span></span>
<span id="cb64-13"><a href="week-2-1.html#cb64-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="week-2-1.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#One might go through the archive</span></span>
<span id="cb65-2"><a href="week-2-1.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#as.data.table(instance$archive)</span></span>
<span id="cb65-3"><a href="week-2-1.html#cb65-3" aria-hidden="true" tabindex="-1"></a>instance<span class="sc">$</span>result</span></code></pre></div>
<pre><code>##            s     alpha learner_param_vals  x_domain regr.rmse
## 1: 0.0623403 0.9998859          &lt;list[3]&gt; &lt;list[2]&gt;  1.037026</code></pre>
<p>We fit the model with the above <span class="math inline">\(s\)</span> (0.0623).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="week-2-1.html#cb67-1" aria-hidden="true" tabindex="-1"></a>elastic_tuned <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)  </span>
<span id="cb67-2"><a href="week-2-1.html#cb67-2" aria-hidden="true" tabindex="-1"></a>elastic_tuned<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> instance<span class="sc">$</span>result_learner_param_vals</span>
<span id="cb67-3"><a href="week-2-1.html#cb67-3" aria-hidden="true" tabindex="-1"></a>elastic_tuned<span class="sc">$</span><span class="fu">train</span>(task_model1)</span></code></pre></div>
<p>Lets quickly look at the predictions.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="week-2-1.html#cb68-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> elastic_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(data_test)</span></code></pre></div>
<p><img src="figures/ML_week2_ex1_04.png" width="75%" style="display: block; margin: auto;" /></p>
<p>For good measures we calculate the beta’s as in lasso.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="week-2-1.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Make identity matrix</span></span>
<span id="cb69-2"><a href="week-2-1.html#cb69-2" aria-hidden="true" tabindex="-1"></a>I <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="at">x=</span><span class="dv">1</span>,<span class="at">nrow =</span> p) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb69-3"><a href="week-2-1.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(I) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_train)[<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb69-4"><a href="week-2-1.html#cb69-4" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> elastic_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(I)</span>
<span id="cb69-5"><a href="week-2-1.html#cb69-5" aria-hidden="true" tabindex="-1"></a>beta_elastic <span class="ot">&lt;-</span> predictions<span class="sc">$</span>response <span class="co">#Look at the beta</span></span>
<span id="cb69-6"><a href="week-2-1.html#cb69-6" aria-hidden="true" tabindex="-1"></a>beta_elastic</span></code></pre></div>
<pre><code>##   [1] 0.99882093 0.79064649 0.99510364 0.94068530 0.93595611 0.03316896
##   [7] 0.03316896 0.03316896 0.03316896 0.03316896 0.10956374 0.03316896
##  [13] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [19] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [25] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [31] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [37] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [43] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [49] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [55] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [61] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [67] 0.14366364 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [73] 0.03316896 0.07532564 0.03316896 0.03316896 0.03316896 0.03316896
##  [79] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [85] 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896 0.03316896
##  [91] 0.03316896 0.03316896 0.03316896 0.03316896 0.06245603 0.04861821
##  [97] 0.03316896 0.03316896 0.03316896 0.03316896</code></pre>
<p>Let’s lastly look at how the different estimators do with respect to the true beta.</p>
<p><img src="figures/ML_week2_ex1_05.png" width="75%" style="display: block; margin: auto;" /></p>
<p>We may now estimate the remaining three models.</p>
<p><strong>Model 2-4.</strong> We generate the data and estimate under the model. We define a function that compute the estimators.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="week-2-1.html#cb71-1" aria-hidden="true" tabindex="-1"></a>getEstimates <span class="ot">&lt;-</span> <span class="cf">function</span>(n,p,s,rho,m,epsilon){</span>
<span id="cb71-2"><a href="week-2-1.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Get data</span></span>
<span id="cb71-3"><a href="week-2-1.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  data_train <span class="ot">&lt;-</span> <span class="fu">generateData</span>(n,p,s,rho,m,epsilon,<span class="dv">1</span>)<span class="sc">$</span>dat</span>
<span id="cb71-4"><a href="week-2-1.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  data_test <span class="ot">&lt;-</span> <span class="fu">generateData</span>(n,p,s,rho,m,epsilon,<span class="dv">2</span>)<span class="sc">$</span>dat</span>
<span id="cb71-5"><a href="week-2-1.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-6"><a href="week-2-1.html#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Identity matrix for parameters</span></span>
<span id="cb71-7"><a href="week-2-1.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  I <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="at">x=</span><span class="dv">1</span>,<span class="at">nrow =</span> p) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb71-8"><a href="week-2-1.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(I) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data_train)[<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb71-9"><a href="week-2-1.html#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="week-2-1.html#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Make ls model</span></span>
<span id="cb71-11"><a href="week-2-1.html#cb71-11" aria-hidden="true" tabindex="-1"></a>  ls_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> ., <span class="at">data =</span> data_train)</span>
<span id="cb71-12"><a href="week-2-1.html#cb71-12" aria-hidden="true" tabindex="-1"></a>  beta_ls <span class="ot">&lt;-</span> <span class="fu">predict</span>(ls_lm,I)</span>
<span id="cb71-13"><a href="week-2-1.html#cb71-13" aria-hidden="true" tabindex="-1"></a>  predictions_ls <span class="ot">&lt;-</span> <span class="fu">predict</span>(ls_lm,data_test)</span>
<span id="cb71-14"><a href="week-2-1.html#cb71-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-15"><a href="week-2-1.html#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Make task</span></span>
<span id="cb71-16"><a href="week-2-1.html#cb71-16" aria-hidden="true" tabindex="-1"></a>  task_model <span class="ot">=</span> <span class="fu">as_task_regr</span>(</span>
<span id="cb71-17"><a href="week-2-1.html#cb71-17" aria-hidden="true" tabindex="-1"></a>    data_train,</span>
<span id="cb71-18"><a href="week-2-1.html#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">target =</span> <span class="st">&quot;Y&quot;</span></span>
<span id="cb71-19"><a href="week-2-1.html#cb71-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-20"><a href="week-2-1.html#cb71-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-21"><a href="week-2-1.html#cb71-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Tune lasso</span></span>
<span id="cb71-22"><a href="week-2-1.html#cb71-22" aria-hidden="true" tabindex="-1"></a>  my_lasso_learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>,</span>
<span id="cb71-23"><a href="week-2-1.html#cb71-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">s=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb71-24"><a href="week-2-1.html#cb71-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span> <span class="dv">1</span>)</span>
<span id="cb71-25"><a href="week-2-1.html#cb71-25" aria-hidden="true" tabindex="-1"></a>  lasso_instance <span class="ot">&lt;-</span> <span class="fu">tune</span>(</span>
<span id="cb71-26"><a href="week-2-1.html#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>), <span class="do">### tuning method</span></span>
<span id="cb71-27"><a href="week-2-1.html#cb71-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">task =</span> task_model,</span>
<span id="cb71-28"><a href="week-2-1.html#cb71-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">learner =</span> my_lasso_learner,</span>
<span id="cb71-29"><a href="week-2-1.html#cb71-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>), <span class="do">#### resampling method: 5-fold cross validation</span></span>
<span id="cb71-30"><a href="week-2-1.html#cb71-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">&quot;regr.rmse&quot;</span>), <span class="do">#### root mean squared error</span></span>
<span id="cb71-31"><a href="week-2-1.html#cb71-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">100</span>) <span class="do">#### terminator</span></span>
<span id="cb71-32"><a href="week-2-1.html#cb71-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-33"><a href="week-2-1.html#cb71-33" aria-hidden="true" tabindex="-1"></a>  lasso_tuned <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)  </span>
<span id="cb71-34"><a href="week-2-1.html#cb71-34" aria-hidden="true" tabindex="-1"></a>  lasso_tuned<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> lasso_instance<span class="sc">$</span>result_learner_param_vals</span>
<span id="cb71-35"><a href="week-2-1.html#cb71-35" aria-hidden="true" tabindex="-1"></a>  lasso_tuned<span class="sc">$</span><span class="fu">train</span>(task_model)</span>
<span id="cb71-36"><a href="week-2-1.html#cb71-36" aria-hidden="true" tabindex="-1"></a>  predictions_lasso <span class="ot">=</span> lasso_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(data_test)</span>
<span id="cb71-37"><a href="week-2-1.html#cb71-37" aria-hidden="true" tabindex="-1"></a>  beta_lasso <span class="ot">&lt;-</span> lasso_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(I)<span class="sc">$</span>response</span>
<span id="cb71-38"><a href="week-2-1.html#cb71-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-39"><a href="week-2-1.html#cb71-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Tune ridge</span></span>
<span id="cb71-40"><a href="week-2-1.html#cb71-40" aria-hidden="true" tabindex="-1"></a>  my_ridge_learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>,</span>
<span id="cb71-41"><a href="week-2-1.html#cb71-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">s=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb71-42"><a href="week-2-1.html#cb71-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span> <span class="dv">0</span>)</span>
<span id="cb71-43"><a href="week-2-1.html#cb71-43" aria-hidden="true" tabindex="-1"></a>  ridge_instance <span class="ot">&lt;-</span> <span class="fu">tune</span>(</span>
<span id="cb71-44"><a href="week-2-1.html#cb71-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>), <span class="do">### tuning method</span></span>
<span id="cb71-45"><a href="week-2-1.html#cb71-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">task =</span> task_model,</span>
<span id="cb71-46"><a href="week-2-1.html#cb71-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">learner =</span> my_ridge_learner,</span>
<span id="cb71-47"><a href="week-2-1.html#cb71-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>), <span class="do">#### resampling method: 5-fold cross validation</span></span>
<span id="cb71-48"><a href="week-2-1.html#cb71-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">&quot;regr.rmse&quot;</span>), <span class="do">#### root mean squared error</span></span>
<span id="cb71-49"><a href="week-2-1.html#cb71-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">100</span>) <span class="do">#### terminator</span></span>
<span id="cb71-50"><a href="week-2-1.html#cb71-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-51"><a href="week-2-1.html#cb71-51" aria-hidden="true" tabindex="-1"></a>  ridge_tuned <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)  </span>
<span id="cb71-52"><a href="week-2-1.html#cb71-52" aria-hidden="true" tabindex="-1"></a>  ridge_tuned<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> ridge_instance<span class="sc">$</span>result_learner_param_vals</span>
<span id="cb71-53"><a href="week-2-1.html#cb71-53" aria-hidden="true" tabindex="-1"></a>  ridge_tuned<span class="sc">$</span><span class="fu">train</span>(task_model)</span>
<span id="cb71-54"><a href="week-2-1.html#cb71-54" aria-hidden="true" tabindex="-1"></a>  predictions_ridge <span class="ot">=</span> ridge_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(data_test)</span>
<span id="cb71-55"><a href="week-2-1.html#cb71-55" aria-hidden="true" tabindex="-1"></a>  beta_ridge <span class="ot">&lt;-</span> ridge_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(I)<span class="sc">$</span>response</span>
<span id="cb71-56"><a href="week-2-1.html#cb71-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-57"><a href="week-2-1.html#cb71-57" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Tune elastic net</span></span>
<span id="cb71-58"><a href="week-2-1.html#cb71-58" aria-hidden="true" tabindex="-1"></a>  my_elastic_learner <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>,</span>
<span id="cb71-59"><a href="week-2-1.html#cb71-59" aria-hidden="true" tabindex="-1"></a>                       <span class="at">s=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb71-60"><a href="week-2-1.html#cb71-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">alpha=</span> <span class="fu">to_tune</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb71-61"><a href="week-2-1.html#cb71-61" aria-hidden="true" tabindex="-1"></a>  elastic_instance <span class="ot">&lt;-</span> <span class="fu">tune</span>(</span>
<span id="cb71-62"><a href="week-2-1.html#cb71-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">tnr</span>(<span class="st">&quot;mbo&quot;</span>), <span class="do">### tuning method</span></span>
<span id="cb71-63"><a href="week-2-1.html#cb71-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">task =</span> task_model,</span>
<span id="cb71-64"><a href="week-2-1.html#cb71-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">learner =</span> my_elastic_learner,</span>
<span id="cb71-65"><a href="week-2-1.html#cb71-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">&quot;cv&quot;</span>, <span class="at">folds =</span> <span class="dv">5</span>), <span class="do">#### resampling method: 5-fold cross validation</span></span>
<span id="cb71-66"><a href="week-2-1.html#cb71-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">measures =</span> <span class="fu">msr</span>(<span class="st">&quot;regr.rmse&quot;</span>), <span class="do">#### root mean squared error</span></span>
<span id="cb71-67"><a href="week-2-1.html#cb71-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">terminator =</span> <span class="fu">trm</span>(<span class="st">&quot;evals&quot;</span>, <span class="at">n_evals =</span> <span class="dv">100</span>) <span class="do">#### terminator</span></span>
<span id="cb71-68"><a href="week-2-1.html#cb71-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-69"><a href="week-2-1.html#cb71-69" aria-hidden="true" tabindex="-1"></a>  elastic_tuned <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">&quot;regr.glmnet&quot;</span>)  </span>
<span id="cb71-70"><a href="week-2-1.html#cb71-70" aria-hidden="true" tabindex="-1"></a>  elastic_tuned<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> elastic_instance<span class="sc">$</span>result_learner_param_vals</span>
<span id="cb71-71"><a href="week-2-1.html#cb71-71" aria-hidden="true" tabindex="-1"></a>  elastic_tuned<span class="sc">$</span><span class="fu">train</span>(task_model)</span>
<span id="cb71-72"><a href="week-2-1.html#cb71-72" aria-hidden="true" tabindex="-1"></a>  predictions_elastic <span class="ot">=</span> elastic_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(data_test)</span>
<span id="cb71-73"><a href="week-2-1.html#cb71-73" aria-hidden="true" tabindex="-1"></a>  beta_elastic <span class="ot">&lt;-</span> elastic_tuned<span class="sc">$</span><span class="fu">predict_newdata</span>(I)<span class="sc">$</span>response</span>
<span id="cb71-74"><a href="week-2-1.html#cb71-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-75"><a href="week-2-1.html#cb71-75" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Combine beta&#39;s</span></span>
<span id="cb71-76"><a href="week-2-1.html#cb71-76" aria-hidden="true" tabindex="-1"></a>  beta_true <span class="ot">&lt;-</span> <span class="fu">m</span>(<span class="fu">diag</span>(<span class="dv">1</span>,<span class="at">nrow =</span> p))</span>
<span id="cb71-77"><a href="week-2-1.html#cb71-77" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb71-78"><a href="week-2-1.html#cb71-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">j =</span> <span class="dv">1</span><span class="sc">:</span>p,</span>
<span id="cb71-79"><a href="week-2-1.html#cb71-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">true =</span> beta_true,</span>
<span id="cb71-80"><a href="week-2-1.html#cb71-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">ls =</span> beta_ls,</span>
<span id="cb71-81"><a href="week-2-1.html#cb71-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">lasso =</span> beta_lasso,</span>
<span id="cb71-82"><a href="week-2-1.html#cb71-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">ridge =</span> beta_ridge,</span>
<span id="cb71-83"><a href="week-2-1.html#cb71-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">elastic_net =</span> beta_elastic</span>
<span id="cb71-84"><a href="week-2-1.html#cb71-84" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-85"><a href="week-2-1.html#cb71-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-86"><a href="week-2-1.html#cb71-86" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Combining predictions</span></span>
<span id="cb71-87"><a href="week-2-1.html#cb71-87" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb71-88"><a href="week-2-1.html#cb71-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb71-89"><a href="week-2-1.html#cb71-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">Truth =</span> data_test<span class="sc">$</span>Y,</span>
<span id="cb71-90"><a href="week-2-1.html#cb71-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">ls =</span> predictions_ls,</span>
<span id="cb71-91"><a href="week-2-1.html#cb71-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">lasso =</span> predictions_lasso<span class="sc">$</span>response,</span>
<span id="cb71-92"><a href="week-2-1.html#cb71-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">ridge =</span> predictions_ridge<span class="sc">$</span>response,</span>
<span id="cb71-93"><a href="week-2-1.html#cb71-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">elastic_net =</span> predictions_elastic<span class="sc">$</span>response</span>
<span id="cb71-94"><a href="week-2-1.html#cb71-94" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-95"><a href="week-2-1.html#cb71-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb71-96"><a href="week-2-1.html#cb71-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_train =</span> data_train,</span>
<span id="cb71-97"><a href="week-2-1.html#cb71-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_test =</span> data_test,</span>
<span id="cb71-98"><a href="week-2-1.html#cb71-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> beta,</span>
<span id="cb71-99"><a href="week-2-1.html#cb71-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictions =</span> predictions,</span>
<span id="cb71-100"><a href="week-2-1.html#cb71-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">instances =</span> <span class="fu">list</span>(</span>
<span id="cb71-101"><a href="week-2-1.html#cb71-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">lasso =</span> lasso_instance,</span>
<span id="cb71-102"><a href="week-2-1.html#cb71-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">ridge =</span> ridge_instance,</span>
<span id="cb71-103"><a href="week-2-1.html#cb71-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">elastic_net =</span> elastic_instance</span>
<span id="cb71-104"><a href="week-2-1.html#cb71-104" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-105"><a href="week-2-1.html#cb71-105" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb71-106"><a href="week-2-1.html#cb71-106" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now we simply gather the results.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="week-2-1.html#cb72-1" aria-hidden="true" tabindex="-1"></a>results1 <span class="ot">&lt;-</span> <span class="fu">getEstimates</span>(</span>
<span id="cb72-2"><a href="week-2-1.html#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">5</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb72-3"><a href="week-2-1.html#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])}</span>
<span id="cb72-4"><a href="week-2-1.html#cb72-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-5"><a href="week-2-1.html#cb72-5" aria-hidden="true" tabindex="-1"></a>results2 <span class="ot">&lt;-</span> <span class="fu">getEstimates</span>(</span>
<span id="cb72-6"><a href="week-2-1.html#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">100</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb72-7"><a href="week-2-1.html#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])}</span>
<span id="cb72-8"><a href="week-2-1.html#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="week-2-1.html#cb72-9" aria-hidden="true" tabindex="-1"></a>results3 <span class="ot">&lt;-</span> <span class="fu">getEstimates</span>(</span>
<span id="cb72-10"><a href="week-2-1.html#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">5</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb72-11"><a href="week-2-1.html#cb72-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(<span class="fl">0.1</span><span class="sc">*</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])}</span>
<span id="cb72-12"><a href="week-2-1.html#cb72-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-13"><a href="week-2-1.html#cb72-13" aria-hidden="true" tabindex="-1"></a>results4 <span class="ot">&lt;-</span> <span class="fu">getEstimates</span>(</span>
<span id="cb72-14"><a href="week-2-1.html#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">100</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb72-15"><a href="week-2-1.html#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(<span class="fl">0.1</span><span class="sc">*</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])}</span>
<span id="cb72-16"><a href="week-2-1.html#cb72-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</details>
<details>
<summary>
<strong>Solution (b).</strong>
</summary>
<p>We simply generate <span class="math inline">\(N=100\)</span> test sets and compute the mean squared error for each run, then take the empirical mean and standard deviation of the 100 samples of the empirical mean squared error.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="week-2-1.html#cb73-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb73-2"><a href="week-2-1.html#cb73-2" aria-hidden="true" tabindex="-1"></a>computeMSE <span class="ot">&lt;-</span> <span class="cf">function</span>(n,p,s,rho,m,epsilon,results,N){</span>
<span id="cb73-3"><a href="week-2-1.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  MSE <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N<span class="sc">+</span><span class="dv">1</span>, <span class="cf">function</span>(j) {</span>
<span id="cb73-4"><a href="week-2-1.html#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Get data</span></span>
<span id="cb73-5"><a href="week-2-1.html#cb73-5" aria-hidden="true" tabindex="-1"></a>    data_test <span class="ot">&lt;-</span> <span class="fu">generateData</span>(n,p,s,rho,m,epsilon,j)<span class="sc">$</span>dat</span>
<span id="cb73-6"><a href="week-2-1.html#cb73-6" aria-hidden="true" tabindex="-1"></a>    mse_ls <span class="ot">&lt;-</span> <span class="fu">mean</span>((data_test<span class="sc">$</span>Y <span class="sc">-</span> <span class="fu">as.matrix</span>(data_test[,<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]) <span class="sc">%*%</span> results<span class="sc">$</span>beta<span class="sc">$</span>ls)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb73-7"><a href="week-2-1.html#cb73-7" aria-hidden="true" tabindex="-1"></a>    mse_lasso <span class="ot">&lt;-</span>  <span class="fu">mean</span>((data_test<span class="sc">$</span>Y <span class="sc">-</span> <span class="fu">as.matrix</span>(data_test[,<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]) <span class="sc">%*%</span> results<span class="sc">$</span>beta<span class="sc">$</span>lasso)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb73-8"><a href="week-2-1.html#cb73-8" aria-hidden="true" tabindex="-1"></a>    mse_ridge <span class="ot">&lt;-</span>  <span class="fu">mean</span>((data_test<span class="sc">$</span>Y <span class="sc">-</span> <span class="fu">as.matrix</span>(data_test[,<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]) <span class="sc">%*%</span> results<span class="sc">$</span>beta<span class="sc">$</span>ridge)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb73-9"><a href="week-2-1.html#cb73-9" aria-hidden="true" tabindex="-1"></a>    mse_elastic <span class="ot">&lt;-</span>  <span class="fu">mean</span>((data_test<span class="sc">$</span>Y <span class="sc">-</span> <span class="fu">as.matrix</span>(data_test[,<span class="dv">2</span><span class="sc">:</span>(p<span class="sc">+</span><span class="dv">1</span>)]) <span class="sc">%*%</span> results<span class="sc">$</span>beta<span class="sc">$</span>elastic_net)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb73-10"><a href="week-2-1.html#cb73-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(mse_ls,mse_lasso,mse_ridge,mse_elastic))</span>
<span id="cb73-11"><a href="week-2-1.html#cb73-11" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb73-12"><a href="week-2-1.html#cb73-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb73-13"><a href="week-2-1.html#cb73-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;LS&quot;</span>,<span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Ridge&quot;</span>,<span class="st">&quot;Elastic net&quot;</span>),</span>
<span id="cb73-14"><a href="week-2-1.html#cb73-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_MSE =</span> <span class="fu">rowMeans</span>(MSE),</span>
<span id="cb73-15"><a href="week-2-1.html#cb73-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_MSE =</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">sd</span>(MSE[i,]))</span>
<span id="cb73-16"><a href="week-2-1.html#cb73-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-17"><a href="week-2-1.html#cb73-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb73-18"><a href="week-2-1.html#cb73-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb73-19"><a href="week-2-1.html#cb73-19" aria-hidden="true" tabindex="-1"></a>MSE_model1 <span class="ot">&lt;-</span> <span class="fu">computeMSE</span>(</span>
<span id="cb73-20"><a href="week-2-1.html#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">5</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb73-21"><a href="week-2-1.html#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])},</span>
<span id="cb73-22"><a href="week-2-1.html#cb73-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">results =</span> results1, N</span>
<span id="cb73-23"><a href="week-2-1.html#cb73-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-24"><a href="week-2-1.html#cb73-24" aria-hidden="true" tabindex="-1"></a>MSE_model2 <span class="ot">&lt;-</span> <span class="fu">computeMSE</span>(</span>
<span id="cb73-25"><a href="week-2-1.html#cb73-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">100</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb73-26"><a href="week-2-1.html#cb73-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])},</span>
<span id="cb73-27"><a href="week-2-1.html#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">results =</span> results2, N</span>
<span id="cb73-28"><a href="week-2-1.html#cb73-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-29"><a href="week-2-1.html#cb73-29" aria-hidden="true" tabindex="-1"></a>MSE_model3 <span class="ot">&lt;-</span> <span class="fu">computeMSE</span>(</span>
<span id="cb73-30"><a href="week-2-1.html#cb73-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">5</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb73-31"><a href="week-2-1.html#cb73-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(<span class="fl">0.1</span><span class="sc">*</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])},</span>
<span id="cb73-32"><a href="week-2-1.html#cb73-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">results =</span> results3, N</span>
<span id="cb73-33"><a href="week-2-1.html#cb73-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-34"><a href="week-2-1.html#cb73-34" aria-hidden="true" tabindex="-1"></a>MSE_model4 <span class="ot">&lt;-</span> <span class="fu">computeMSE</span>(</span>
<span id="cb73-35"><a href="week-2-1.html#cb73-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">1000</span>, <span class="at">p =</span> <span class="dv">100</span>, <span class="at">s =</span> <span class="dv">100</span>, <span class="at">rho =</span> <span class="fl">0.3</span>, <span class="at">epsilon =</span> <span class="dv">1</span>,</span>
<span id="cb73-36"><a href="week-2-1.html#cb73-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">m =</span> <span class="cf">function</span>(x){<span class="fu">rowSums</span>(<span class="fl">0.1</span><span class="sc">*</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])},</span>
<span id="cb73-37"><a href="week-2-1.html#cb73-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">results =</span> results4, N</span>
<span id="cb73-38"><a href="week-2-1.html#cb73-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-39"><a href="week-2-1.html#cb73-39" aria-hidden="true" tabindex="-1"></a>MSE_means <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb73-40"><a href="week-2-1.html#cb73-40" aria-hidden="true" tabindex="-1"></a>  MSE_model1<span class="sc">$</span>mean_MSE,MSE_model2<span class="sc">$</span>mean_MSE,</span>
<span id="cb73-41"><a href="week-2-1.html#cb73-41" aria-hidden="true" tabindex="-1"></a>  MSE_model3<span class="sc">$</span>mean_MSE,MSE_model4<span class="sc">$</span>mean_MSE</span>
<span id="cb73-42"><a href="week-2-1.html#cb73-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-43"><a href="week-2-1.html#cb73-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MSE_means) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Least Squares&quot;</span>,<span class="st">&quot;Lasso&quot;</span>,<span class="st">&quot;Ridge&quot;</span>,<span class="st">&quot;Elastic net&quot;</span>)</span>
<span id="cb73-44"><a href="week-2-1.html#cb73-44" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(MSE_means) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Model 1&quot;</span>,<span class="st">&quot;Model 2&quot;</span>,<span class="st">&quot;Model 3&quot;</span>, <span class="st">&quot;Model 4&quot;</span>)</span>
<span id="cb73-45"><a href="week-2-1.html#cb73-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb73-46"><a href="week-2-1.html#cb73-46" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(MSE_means)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Least Squares
</th>
<th style="text-align:right;">
Lasso
</th>
<th style="text-align:right;">
Ridge
</th>
<th style="text-align:right;">
Elastic net
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Model 1
</td>
<td style="text-align:right;">
1.512701
</td>
<td style="text-align:right;">
1.839267
</td>
<td style="text-align:right;">
1.579840
</td>
<td style="text-align:right;">
1.843050
</td>
</tr>
<tr>
<td style="text-align:left;">
Model 2
</td>
<td style="text-align:right;">
797.525805
</td>
<td style="text-align:right;">
788.769559
</td>
<td style="text-align:right;">
793.827888
</td>
<td style="text-align:right;">
793.827772
</td>
</tr>
<tr>
<td style="text-align:left;">
Model 3
</td>
<td style="text-align:right;">
1.512701
</td>
<td style="text-align:right;">
1.885876
</td>
<td style="text-align:right;">
1.705212
</td>
<td style="text-align:right;">
1.890599
</td>
</tr>
<tr>
<td style="text-align:left;">
Model 4
</td>
<td style="text-align:right;">
12.609626
</td>
<td style="text-align:right;">
12.198187
</td>
<td style="text-align:right;">
13.090003
</td>
<td style="text-align:right;">
12.987817
</td>
</tr>
</tbody>
</table>
</details>
<details>
<summary>
<strong>Solution (c).</strong>
</summary>
<p>In general, it is better to have as small of a test error as possible. It it however also important not to overcomplicate the model if not all variables is relevant. Ridge regression does well in the models with fewer explanatory variable <span class="math inline">\(s\)</span> as it punishes under <span class="math inline">\(L^2\)</span> distance rather than <span class="math inline">\(L^1\)</span>. This means that ridge does a better job in setting <span class="math inline">\(\beta_j\approx 0\)</span> for <span class="math inline">\(j&gt; s\)</span>.</p>
</details>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="week-1-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="week-3-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
